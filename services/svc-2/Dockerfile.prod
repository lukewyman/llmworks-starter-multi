# Stage 1: build wheels
FROM python:3.12-slim AS build
WORKDIR /build
RUN pip install --no-cache-dir uv
COPY pyproject.toml /build/
COPY src /build/src
RUN uv pip wheel . --wheel-dir /build/wheels

# Stage 2: runtime image
FROM python:3.12-slim AS runtime
ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1
WORKDIR /app
COPY --from=build /build/wheels /wheels
RUN pip install --no-cache-dir /wheels/*.whl && rm -rf /wheels
EXPOSE 8080

CMD ["uvicorn", "svc_2.main:app", "--host", "0.0.0.0", "--port", "8080"]
